{"id":"oLo9","dependencies":[{"name":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/.babelrc","includedInParent":true,"mtime":1576067858414},{"name":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/package.json","includedInParent":true,"mtime":1576066661334},{"name":"../common/apollo/client","loc":{"line":2,"column":32},"parent":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/ensure-initial-data.ts","resolved":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/common/apollo/client.js"},{"name":"./mutations/createUserWithDashboard","loc":{"line":3,"column":40},"parent":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/ensure-initial-data.ts","resolved":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/mutations/createUserWithDashboard.ts"},{"name":"./mutations/deleteManyCharts","loc":{"line":4,"column":33},"parent":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/ensure-initial-data.ts","resolved":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/mutations/deleteManyCharts.ts"},{"name":"./queries/getUserIds","loc":{"line":5,"column":27},"parent":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/ensure-initial-data.ts","resolved":"/home/tom/Code/Code9/SmallCrypto/platform/services/api/src/importer/queries/getUserIds.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.ensureInitialData=l;var e=o(require(\"dotenv\")),t=require(\"../common/apollo/client\"),a=require(\"./mutations/createUserWithDashboard\"),r=require(\"./mutations/deleteManyCharts\"),n=require(\"./queries/getUserIds\");function o(e){return e&&e.__esModule?e:{default:e}}e.default.config();const{PRISMA_HOST:s,PRISMA_PORT:i}=process.env;async function l(){var e,o;console.log(\"ensureInitialData\");const l=(0,t.getApolloClient)({uri:`http://${s}:${i}`}),u=await l.query({query:n.getUserIds});if((null==u?void 0:null===(e=u.data)||void 0===e?void 0:null===(o=e.users)||void 0===o?void 0:o.length)>0)console.log(\"ensureInitialData users exist, removing charts\"),await l.mutate({mutation:r.deleteManyCharts}),console.log(\"ensureInitialData charts removed\");else{console.log(\"ensureInitialData creating new users\");const e=await l.mutate({mutation:a.createUserWithDashboard,variables:{name:\"admin\"}});console.log(\"ensureInitialData createUserWithDashboardResult\",e)}console.log(\"ensureInitialData done\")}"},"sourceMaps":{"js":{"mappings":[{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":0}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":13}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":20}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":35}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":43}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":56}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":57}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":64}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":68}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":76}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":94}},{"source":"importer/ensure-initial-data.ts","original":{"line":1,"column":0},"generated":{"line":1,"column":96}},{"source":"importer/ensure-initial-data.ts","original":{"line":1,"column":0},"generated":{"line":1,"column":100}},{"source":"importer/ensure-initial-data.ts","original":{"line":1,"column":0},"generated":{"line":1,"column":102}},{"source":"importer/ensure-initial-data.ts","original":{"line":1,"column":0},"generated":{"line":1,"column":104}},{"source":"importer/ensure-initial-data.ts","original":{"line":1,"column":0},"generated":{"line":1,"column":112}},{"source":"importer/ensure-initial-data.ts","original":{"line":2,"column":0},"generated":{"line":1,"column":123}},{"source":"importer/ensure-initial-data.ts","original":{"line":2,"column":0},"generated":{"line":1,"column":125}},{"source":"importer/ensure-initial-data.ts","original":{"line":2,"column":0},"generated":{"line":1,"column":133}},{"source":"importer/ensure-initial-data.ts","original":{"line":3,"column":0},"generated":{"line":1,"column":160}},{"source":"importer/ensure-initial-data.ts","original":{"line":3,"column":0},"generated":{"line":1,"column":162}},{"source":"importer/ensure-initial-data.ts","original":{"line":3,"column":0},"generated":{"line":1,"column":170}},{"source":"importer/ensure-initial-data.ts","original":{"line":4,"column":0},"generated":{"line":1,"column":209}},{"source":"importer/ensure-initial-data.ts","original":{"line":4,"column":0},"generated":{"line":1,"column":211}},{"source":"importer/ensure-initial-data.ts","original":{"line":4,"column":0},"generated":{"line":1,"column":219}},{"source":"importer/ensure-initial-data.ts","original":{"line":5,"column":0},"generated":{"line":1,"column":251}},{"source":"importer/ensure-initial-data.ts","original":{"line":5,"column":0},"generated":{"line":1,"column":253}},{"source":"importer/ensure-initial-data.ts","original":{"line":5,"column":0},"generated":{"line":1,"column":261}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":285}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":294}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":296}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":299}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":306}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":309}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":311}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":322}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":324}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":325}},{"source":"importer/ensure-initial-data.ts","original":{"line":41,"column":1},"generated":{"line":1,"column":333}},{"source":"importer/ensure-initial-data.ts","name":"dotenv","original":{"line":7,"column":0},"generated":{"line":1,"column":336}},{"source":"importer/ensure-initial-data.ts","name":"config","original":{"line":7,"column":7},"generated":{"line":1,"column":338}},{"source":"importer/ensure-initial-data.ts","name":"config","original":{"line":7,"column":7},"generated":{"line":1,"column":346}},{"source":"importer/ensure-initial-data.ts","original":{"line":9,"column":0},"generated":{"line":1,"column":355}},{"source":"importer/ensure-initial-data.ts","original":{"line":9,"column":6},"generated":{"line":1,"column":361}},{"source":"importer/ensure-initial-data.ts","name":"PRISMA_HOST","original":{"line":9,"column":8},"generated":{"line":1,"column":373}},{"source":"importer/ensure-initial-data.ts","original":{"line":9,"column":6},"generated":{"line":1,"column":375}},{"source":"importer/ensure-initial-data.ts","name":"PRISMA_PORT","original":{"line":9,"column":21},"generated":{"line":1,"column":387}},{"source":"importer/ensure-initial-data.ts","name":"process","original":{"line":9,"column":37},"generated":{"line":1,"column":390}},{"source":"importer/ensure-initial-data.ts","name":"env","original":{"line":9,"column":45},"generated":{"line":1,"column":398}},{"source":"importer/ensure-initial-data.ts","original":{"line":11,"column":7},"generated":{"line":1,"column":402}},{"source":"importer/ensure-initial-data.ts","name":"ensureInitialData","original":{"line":11,"column":22},"generated":{"line":1,"column":417}},{"source":"importer/ensure-initial-data.ts","original":{"line":11,"column":42},"generated":{"line":1,"column":421}},{"source":"importer/ensure-initial-data.ts","original":{"line":11,"column":42},"generated":{"line":1,"column":425}},{"source":"importer/ensure-initial-data.ts","original":{"line":11,"column":42},"generated":{"line":1,"column":427}},{"source":"importer/ensure-initial-data.ts","name":"console","original":{"line":12,"column":2},"generated":{"line":1,"column":429}},{"source":"importer/ensure-initial-data.ts","name":"log","original":{"line":12,"column":10},"generated":{"line":1,"column":437}},{"source":"importer/ensure-initial-data.ts","original":{"line":12,"column":14},"generated":{"line":1,"column":441}},{"source":"importer/ensure-initial-data.ts","name":"apolloClient","original":{"line":14,"column":8},"generated":{"line":1,"column":462}},{"source":"importer/ensure-initial-data.ts","name":"apolloClient","original":{"line":14,"column":8},"generated":{"line":1,"column":468}},{"source":"importer/ensure-initial-data.ts","original":{"line":14,"column":23},"generated":{"line":1,"column":471}},{"source":"importer/ensure-initial-data.ts","original":{"line":14,"column":39},"generated":{"line":1,"column":473}},{"source":"importer/ensure-initial-data.ts","original":{"line":14,"column":39},"generated":{"line":1,"column":475}},{"source":"importer/ensure-initial-data.ts","original":{"line":14,"column":39},"generated":{"line":1,"column":492}},{"source":"importer/ensure-initial-data.ts","name":"uri","original":{"line":15,"column":4},"generated":{"line":1,"column":493}},{"source":"importer/ensure-initial-data.ts","name":"PRISMA_HOST","original":{"line":15,"column":19},"generated":{"line":1,"column":507}},{"source":"importer/ensure-initial-data.ts","name":"PRISMA_PORT","original":{"line":15,"column":34},"generated":{"line":1,"column":512}},{"source":"importer/ensure-initial-data.ts","name":"usersResult","original":{"line":18,"column":8},"generated":{"line":1,"column":518}},{"source":"importer/ensure-initial-data.ts","name":"apolloClient","original":{"line":18,"column":28},"generated":{"line":1,"column":526}},{"source":"importer/ensure-initial-data.ts","name":"query","original":{"line":18,"column":41},"generated":{"line":1,"column":528}},{"source":"importer/ensure-initial-data.ts","original":{"line":18,"column":47},"generated":{"line":1,"column":534}},{"source":"importer/ensure-initial-data.ts","name":"query","original":{"line":18,"column":49},"generated":{"line":1,"column":535}},{"source":"importer/ensure-initial-data.ts","name":"getUserIds","original":{"line":18,"column":56},"generated":{"line":1,"column":541}},{"source":"importer/ensure-initial-data.ts","name":"getUserIds","original":{"line":18,"column":56},"generated":{"line":1,"column":543}},{"source":"importer/ensure-initial-data.ts","name":"usersExist","original":{"line":21,"column":6},"generated":{"line":1,"column":556}},{"source":"importer/ensure-initial-data.ts","name":"usersResult","original":{"line":19,"column":21},"generated":{"line":1,"column":560}},{"source":"importer/ensure-initial-data.ts","name":"usersResult","original":{"line":19,"column":21},"generated":{"line":1,"column":566}},{"source":"importer/ensure-initial-data.ts","name":"usersResult","original":{"line":19,"column":21},"generated":{"line":1,"column":573}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":575}},{"source":"importer/ensure-initial-data.ts","name":"usersResult","original":{"line":19,"column":21},"generated":{"line":1,"column":583}},{"source":"importer/ensure-initial-data.ts","name":"usersResult","original":{"line":19,"column":21},"generated":{"line":1,"column":585}},{"source":"importer/ensure-initial-data.ts","name":"data","original":{"line":19,"column":34},"generated":{"line":1,"column":587}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":599}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":603}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":610}},{"source":"importer/ensure-initial-data.ts","name":"length","original":{"line":19,"column":47},"generated":{"line":1,"column":612}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":620}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":622}},{"source":"importer/ensure-initial-data.ts","name":"users","original":{"line":19,"column":40},"generated":{"line":1,"column":624}},{"source":"importer/ensure-initial-data.ts","name":"length","original":{"line":19,"column":47},"generated":{"line":1,"column":637}},{"source":"importer/ensure-initial-data.ts","name":"length","original":{"line":19,"column":47},"generated":{"line":1,"column":641}},{"source":"importer/ensure-initial-data.ts","name":"length","original":{"line":19,"column":47},"generated":{"line":1,"column":648}},{"source":"importer/ensure-initial-data.ts","name":"length","original":{"line":19,"column":47},"generated":{"line":1,"column":650}},{"source":"importer/ensure-initial-data.ts","name":"length","original":{"line":19,"column":47},"generated":{"line":1,"column":652}},{"source":"importer/ensure-initial-data.ts","original":{"line":19,"column":56},"generated":{"line":1,"column":660}},{"source":"importer/ensure-initial-data.ts","name":"console","original":{"line":22,"column":4},"generated":{"line":1,"column":662}},{"source":"importer/ensure-initial-data.ts","name":"log","original":{"line":22,"column":12},"generated":{"line":1,"column":670}},{"source":"importer/ensure-initial-data.ts","original":{"line":22,"column":16},"generated":{"line":1,"column":674}},{"source":"importer/ensure-initial-data.ts","name":"apolloClient","original":{"line":24,"column":10},"generated":{"line":1,"column":730}},{"source":"importer/ensure-initial-data.ts","name":"mutate","original":{"line":24,"column":23},"generated":{"line":1,"column":732}},{"source":"importer/ensure-initial-data.ts","original":{"line":24,"column":30},"generated":{"line":1,"column":739}},{"source":"importer/ensure-initial-data.ts","name":"mutation","original":{"line":24,"column":32},"generated":{"line":1,"column":740}},{"source":"importer/ensure-initial-data.ts","name":"deleteManyCharts","original":{"line":24,"column":42},"generated":{"line":1,"column":749}},{"source":"importer/ensure-initial-data.ts","name":"deleteManyCharts","original":{"line":24,"column":42},"generated":{"line":1,"column":751}},{"source":"importer/ensure-initial-data.ts","name":"console","original":{"line":26,"column":4},"generated":{"line":1,"column":770}},{"source":"importer/ensure-initial-data.ts","name":"log","original":{"line":26,"column":12},"generated":{"line":1,"column":778}},{"source":"importer/ensure-initial-data.ts","original":{"line":26,"column":16},"generated":{"line":1,"column":782}},{"source":"importer/ensure-initial-data.ts","original":{"line":27,"column":9},"generated":{"line":1,"column":822}},{"source":"importer/ensure-initial-data.ts","name":"console","original":{"line":28,"column":4},"generated":{"line":1,"column":823}},{"source":"importer/ensure-initial-data.ts","name":"log","original":{"line":28,"column":12},"generated":{"line":1,"column":831}},{"source":"importer/ensure-initial-data.ts","original":{"line":28,"column":16},"generated":{"line":1,"column":835}},{"source":"importer/ensure-initial-data.ts","name":"createUserWithDashboardResult","original":{"line":30,"column":10},"generated":{"line":1,"column":875}},{"source":"importer/ensure-initial-data.ts","name":"createUserWithDashboardResult","original":{"line":30,"column":10},"generated":{"line":1,"column":881}},{"source":"importer/ensure-initial-data.ts","name":"apolloClient","original":{"line":30,"column":48},"generated":{"line":1,"column":889}},{"source":"importer/ensure-initial-data.ts","name":"mutate","original":{"line":30,"column":61},"generated":{"line":1,"column":891}},{"source":"importer/ensure-initial-data.ts","original":{"line":30,"column":68},"generated":{"line":1,"column":898}},{"source":"importer/ensure-initial-data.ts","name":"mutation","original":{"line":31,"column":6},"generated":{"line":1,"column":899}},{"source":"importer/ensure-initial-data.ts","name":"createUserWithDashboard","original":{"line":31,"column":16},"generated":{"line":1,"column":908}},{"source":"importer/ensure-initial-data.ts","original":{"line":30,"column":68},"generated":{"line":1,"column":910}},{"source":"importer/ensure-initial-data.ts","name":"variables","original":{"line":32,"column":6},"generated":{"line":1,"column":934}},{"source":"importer/ensure-initial-data.ts","original":{"line":32,"column":17},"generated":{"line":1,"column":944}},{"source":"importer/ensure-initial-data.ts","name":"name","original":{"line":33,"column":8},"generated":{"line":1,"column":945}},{"source":"importer/ensure-initial-data.ts","original":{"line":33,"column":14},"generated":{"line":1,"column":950}},{"source":"importer/ensure-initial-data.ts","name":"console","original":{"line":37,"column":4},"generated":{"line":1,"column":961}},{"source":"importer/ensure-initial-data.ts","name":"log","original":{"line":37,"column":12},"generated":{"line":1,"column":969}},{"source":"importer/ensure-initial-data.ts","original":{"line":37,"column":16},"generated":{"line":1,"column":973}},{"source":"importer/ensure-initial-data.ts","name":"createUserWithDashboardResult","original":{"line":37,"column":67},"generated":{"line":1,"column":1023}},{"source":"importer/ensure-initial-data.ts","name":"console","original":{"line":40,"column":2},"generated":{"line":1,"column":1026}},{"source":"importer/ensure-initial-data.ts","name":"log","original":{"line":40,"column":10},"generated":{"line":1,"column":1034}},{"source":"importer/ensure-initial-data.ts","original":{"line":40,"column":14},"generated":{"line":1,"column":1038}}],"sources":{"importer/ensure-initial-data.ts":"import dotenv from 'dotenv'\nimport { getApolloClient } from '../common/apollo/client'\nimport { createUserWithDashboard } from './mutations/createUserWithDashboard'\nimport { deleteManyCharts } from './mutations/deleteManyCharts'\nimport { getUserIds } from './queries/getUserIds'\n\ndotenv.config()\n\nconst { PRISMA_HOST, PRISMA_PORT } = process.env\n\nexport async function ensureInitialData() {\n  console.log('ensureInitialData')\n\n  const apolloClient = getApolloClient({\n    uri: `http://${PRISMA_HOST}:${PRISMA_PORT}`,\n  })\n\n  const usersResult = await apolloClient.query({ query: getUserIds })\n  const usersExist = usersResult?.data?.users?.length > 0\n\n  if (usersExist) {\n    console.log('ensureInitialData users exist, removing charts')\n\n    await apolloClient.mutate({ mutation: deleteManyCharts })\n\n    console.log('ensureInitialData charts removed')\n  } else {\n    console.log('ensureInitialData creating new users')\n\n    const createUserWithDashboardResult = await apolloClient.mutate({\n      mutation: createUserWithDashboard,\n      variables: {\n        name: 'admin',\n      },\n    })\n\n    console.log('ensureInitialData createUserWithDashboardResult', createUserWithDashboardResult)\n  }\n\n  console.log('ensureInitialData done')\n}\n"},"lineCount":null}},"error":null,"hash":"a73717b6c3b07a7fc7665383e9ef16ec","cacheData":{"env":{}}}